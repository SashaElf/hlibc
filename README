grafmusl

DESCRIPTION:
------------

	grafmusl is an experimental fork of musl libc. The original musl
	libc was authored by Rich Felker and first released in 2005.

	This fork was derived from musl version musl-0.9.0.

	Musl has been actively maintained for over 12 years from 2005 to
	the present (2017) making it an ideal study into the workings of a
	modern libc. The primary goal of this project is to reduce an older
	version of musl to its "normative case" of crt stuffs, syscalls and
	linux ABI

	Musl libc also contains a copy of the the Sun fdlibm libm math
	library. It is a goal of this project to also understand and disect
	the sun fdlibm mathematics library.


CHANGES:
--------

	Fdlibm 'musllibc' and 'graflibc' were all seperated into their
	own directories but still sharing common headers.

	Imported bzero from Tuomo Venäläinen's OS-Zero.

	Stdlib has been replaced with grafland libc's stdlib.
	
	Stdio has been replaced with the stdio from grafland libc.
	
	A small experimental malloc implementation was imported and
	tested.

	Musl's syscall_cp creates a cancellation point (one can see 
	pthread_cancel in modern musl). All of these instances have
	been replaced with syscall proper.

	A new string library was imported from grafland libc.

	The ctype library was imported from grafland libc.  

	Architecture specific assembly code has been removed from libm.

	Complex number support has been removed.

	Multibyte support has been completely removed.

	Removed src/prng src/stub src/search src/temp src/regex
	src/aio src/mq and numerous other directories and their
	dependencies in an attempt to narrow musl down to its
	normative case.

	Consolidated documentation into a single README and created a 
	corresponding web page README.html.

	Created a build.sh script to automatically build and test
	the normative libc case.


IRC:
----

	To discuss the development of grafmusl on irc I can generally
	be found on Freenode.

		##programming on irc.freenode.net

	The primary musl development channel can be found on Freenode

		#musl on irc.freenode.net



BUILDING:
---------


	Musl contains a shell script wrapper for gcc called musl-gcc. This
	allows it to be easily installed and used from your home directory
	without the need for root privilege.

		cd grafmusl 
		./configure --prefix=/home/$USER/buildarea 
		make 
		make install

	Test the installation:

		cd /home/$USER/buildarea 
		./bin/musl-gcc tests/pow_test.c -static


AUTOMATIC TESTING:
------------------

	grafmusl has an extra script added which is named "build.sh". It
	serves as a wrapper to the makefile commands. It compiles and
	runs a simple test suite. It's much easier to test grafmusl this
	way, as the developer can get a basic idea of any regressions by
	invoking a single command. By default it installs to the directory
	"installation" automatically as a subdirectory of the grafmusl 
	build system. Use the following instructions to retrieve, build
	and run the grafmusl test suite.


		git clone https://www.githuc.com/cmgraff/grafmusl
		cd grafmusl
		./build.sh

	If all ran successfully there should be no significant errors and
	a confirmation notice containing the results of the test suite 
	will be printed to screen looking something like this:

	
		==========TEST SUITE START==================================
		This number should be (16): 16.000000
		The `cat' utility successfully copied a file
		The `malloc_driver' test utility successfully iterated ...
			...
		============================================================
	



REVISION CONTROL:
-----------------

	https://github.com/cmgraff/grafmusl


REFERENCES:
-----------

	Musl's home website:

		https://www.musl-libc.org

	A website authored by Rich Felker / dalais, the maker of musl:

		https://ewontfix.com/about 

	A tutorial on implementing malloc:

		https://danluu.com/malloc-tutorial

	Some useful sites from the people on ##c irc.freenode.net

		http://www.iso-9899.info

		http://www.iso-9899.info/wiki/Books

	An early book about the history of unix:

		ftp://minnie.tuhs.org/UnixArchive/Documentation/Books/Life_with_Unix.pdf

	Some small articles pertaining to the book "Software tools" by Kernighan and Plauger

		phk.freebsd.dk/pubs/EuroBSDcon2010_SoftwareTools.pdf

		alumnus.caltech.edu/~copeland/work/PDF/1999-08-ppt.pdf






ORIGINAL README:
----------------

	musl libc - a new standard library to power a new generation of
	Linux-based devices. musl is lightweight, fast, simple, free, and
	strives to be correct in the sense of standards-conformance and
	safety.
	
	musl is an alternative to glibc, eglibc, uClibc, dietlibc, and klibc.
	For reasons why one might prefer musl, please see the FAQ and libc
	comparison chart on the project website,
	
	    http://www.etalabs.net/musl
	
	For installation instructions, see the INSTALL file.
	
	Please refer to the COPYRIGHT file for details on the copyright and
	license status of code included in musl (standard MIT license).
	
	
	
	Greetings!
	
	With the 0.9.0 release, musl has reached a milestone in completeness
	and compatibility. All interfaces in ISO C99 and POSIX 2008 base exist
	in musl, along with a number of non-standardized interfaces based on
	GNU and BSD libraries and syscall interfaces for Linux-kernel-specific
	functions. Some interfaces lack obscure or rarely-used functionality
	needed for strict conformance, but the vast majority of interfaces go
	above and beyond the requirements for conformance, often promising
	success where other implementations can fail under resource exhaustion
	or other corner-case conditions.
	
	At this point, hundreds of packages have been successfully built
	against musl - either out-of-the-box or with minor patches to address
	portability errors - ranging from low-level system utilities and
	network daemons to major gui applications. Testing has been conducted
	using three separate test frameworks and numerous additional
	standalone test cases to verify the correctness of the implementation.
	
	Included with this package is a gcc wrapper script (musl-gcc) which
	allows you to build musl-linked programs using an existing gcc 3.x or
	4.x toolchain on the host. There are also now at several mini
	distributions (in the form of build scripts) which provide a
	self-hosting musl-based toolchain and system root. These are much
	better options than the wrapper script if you wish to use dynamic
	linking or build packages with many library dependencies. See the musl
	website for details.
	
	The musl project is actively seeking contributors, mostly in the areas
	of porting, testing, and application compatibility improvement. For
	bug reports, support requests, or to get involved in development,
	please visit #musl on Freenode IRC or subscribe to the musl mailing
	list by sending a blank email to musl-subscribe AT lists DOT openwall
	DOT com.
	
	Thank you for using musl.
	
	Cheers,
	
	Rich Felker / dalias


ORIGINAL INSTALLATION INSTRUCTIONS:
-----------------------------------

	==== Installing musl ====
	
	musl may be installed either as an alternate C library alongside the
	existing libraries on a system, or as the primary C library for a new
	or existing musl-based system.
	
	First, some prerequisites:
	
	- A C99 compiler with gcc-style inline assembly support, support for
	  weak aliases, and support for building stand-alone assembly files.
	  gcc 3.x and 4.x are known to work. pcc and LLVM/clang may work but
	  are untested, and pcc is known to have some bugs.
	
	- GNU make
	
	- Linux, preferably 2.6.22 or later. Older versions are known to have
	  serious bugs that will make some interfaces non-conformant, but if
	  you don't need threads or POSIX 2008 features, even 2.4 is probably
	  okay.
	
	- A supported CPU architecture (currently i386, x86_64, or arm).
	
	- If you want to use dynamic linking, it's recommended that you have
	  permissions to write to /lib and /etc. Otherwise your binaries will
	  have to use a nonstandard dynamic linker path.
	
	
	
	== Option 1: Installing musl as an alternate C library ==
	
	In this setup, musl and any third-party libraries linked to musl will
	reside under an alternate prefix such as /usr/local/musl or /opt/musl.
	A wrapper script for gcc, called musl-gcc, can be used in place of gcc
	to compile and link programs and libraries against musl.
	
	To install musl as an alternate libc, follow these steps:
	
	1. Configure musl's build with a command similar to:
	   ./configure --prefix=/usr/local/musl --exec-prefix=/usr/local
	   Refer to ./configure --help for details on other options. You may
	   change the install prefix if you like, but DO NOT set it to a
	   location that contains your existing libraries based on another
	   libc such as glibc or uClibc. If you do not intend to use dynamic
	   linking, you may disable it at this point via --disable-shared and
	   cut the build time in half. If you wish to use dynamic linking but
	   do not have permissions to write to /lib, you will need to set an
	   alternate dynamic linker location via --syslibdir.
	
	2. Run "make". Parallel build is fully supported, so you can instead
	   use "make -j3" or so on SMP systems if you like.
	
	3. Run "make install" as a user sufficient privileges to write to the
	   destination.
	
	4. Create a file named /etc/ld-musl-$ARCH.path (where $ARCH is
	   replaced by i386, x86_64, etc. as appropriate) containing the
	   correct colon-delimited search path for where you intend to install
	   musl-linked shared library files. If this file is missing, musl
	   will search the standard path, and you will encounter problems when
	   it attempts to load libraries linked against your host libc. Note
	   that this step can be skipped if you disabled dynamic linking.
	
	After installing, you can use musl via the musl-gcc wrapper. For
	example:
	
	cat > hello.c <<EOF
	#include <stdio.h>
	int main()
	{
		printf("hello, world!\n");
		return 0;
	}
	EOF
	musl-gcc hello.c
	./a.out
	
	To configure autoconf-based program to compile and link against musl,
	you may wish to use:
	
	CC="musl-gcc -D_GNU_SOURCE" ./configure ...
	
	Correctly-written build systems should not need -D_GNU_SOURCE as part
	of $CC, but many programs do not use feature-test macros correctly and
	simply assume the compiler will automatically give them the kitchen
	sink, so the above command is an easy workaround.
	
	You will probably also want to use --prefix when building libraries to
	ensure that they are installed under the musl prefix and not in the
	main host system library directories.
	
	Finally, it's worth noting that musl's include and lib directories in
	the build tree are setup to be usable without installation, if
	necessary. Just modify the the paths in the spec file used by musl-gcc
	(it's located at $prefix/lib/musl-gcc.specs) to point to the
	source/build tree.
	
	
	
	== Option 2: Installing musl as the primary C library ==
	
	In this setup, you will need an existing compiler/toolchain. It
	shouldnt matter whether it was configured for glibc, uClibc, musl, or
	something else entirely, but sometimes gcc can be uncooperative,
	especially if the system distributor has built gcc with strange
	options. It probably makes the most sense to perform the following
	steps inside a chroot setup or on a virtualized machine with the
	filesystem containing just a minimal toolchain.
	
	WARNING: DO NOT DO THIS ON AN EXISTING SYSTEM UNLESS YOU REALLY WANT
	TO CONVERT IT TO BE A MUSL-BASED SYSTEM!!
	
	1. If you are just upgrading an existing version of musl, you can skip
	   step 1 entirely. Otherwise, move the existing include and lib
	   directories on your system out of the way. Unless all the binaries
	   you will need are static-linked, you should edit /etc/ld.so.conf
	   (or equivalent) and put the new locations of your old libraries in
	   the search path before you move them, or your system will break
	   badly and you will not be able to continue.
	
	2. Configure musl's build with a command similar to:
	   ./configure --prefix=/usr --disable-gcc-wrapper
	   Refer to ./configure --help for details on other options.
	
	3. Run "make" to compile musl.
	
	4. Run "make install" with appropriate privileges.
	
	5. If you are using gcc and wish to use dynamic linking, find the gcc
	   directory containing libgcc.a (it should be something like
	   /usr/lib/gcc/i486-linux-gnu/4.3.5, with the arch and version
	   possibly different) and look for a specs file there. If none
	   exists, use "gcc -dumpspecs > specs" to generate a specs file. Find
	   the dynamic linker (/lib/ld-linux.so.2 or similar) and change it to
	   "/lib/ld-musl-$ARCH.so.1" (with $ARCH replaced by your CPU arch).
	
	At this point, musl should be the default libc. Compile a small test
	program with gcc and verify (using readelf -a or objdump -x) that the
	dynamic linker (program interpreter) is /lib/ld-musl-$ARCH.so.1. If
	you're using static linking only, you might instead check the symbols
	and look for anything suspicious that would indicate your old glibc or
	uClibc was used.
	
	When building programs against musl, you may still want to ensure the
	appropriate feature test macros get defined, as in:
	
	CC="gcc -D_GNU_SOURCE" ./configure ...
