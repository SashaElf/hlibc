grafmusl

DESCRIPTION:
------------

	grafmusl is a completely rewritten experimental fork of musl libc. 
	The original musl libc was authored by Rich Felker and first released 
	in 2005.  This fork was derived from musl version musl-0.9.0 and
	authored by CM Graff et al in 2017. At least 50 percent of the code 
	that is not part of Sun's fdlibm is original grafland libc code at the 
	time of this writing.


CHANGES:
--------

	Over 45000 lines of code removed from musl. Only 2500 loc
	of the original .c files remain.

	Fdlibm 'musllibc' and 'graflibc' were all seperated into their
	own directories but still sharing common headers.

	Complex number support has been removed.

	Multibyte support has been removed.

	Crypto support has been removed.

	Thread support has been removed.

	Imported bzero from Tuomo Venäläinen's OS-Zero.

	Stdlib has been replaced with grafland libc's stdlib.
	
	Stdio has been replaced with the stdio from grafland libc.
	
	A small experimental malloc implementation was imported and
	tested.

	Musl's syscall_cp creates a cancellation point (one can see 
	pthread_cancel in modern musl). All of these instances have
	been replaced with syscall proper.

	A new string library was imported from grafland libc.

	The ctype library was imported from grafland libc.  

	Architecture specific assembly code has been removed from libm.

	Consolidated documentation into a single README and created a 
	corresponding web page README.html.

	Created a build.sh script to automatically build and test
	the normative libc case.


IRC:
----

	To discuss the development of grafmusl on irc I can generally
	be found on Freenode.

		##programming on irc.freenode.net 


BUILDING:
---------

	grafmusl contains a shell script wrapper for gcc called gcc-wrap. This
	allows it to be easily installed and used from your home directory
	without the need for root privilege.

		cd grafmusl 
		./configure --prefix=/home/$USER/buildarea 
		make 
		make install

	Test the installation:

		cd /home/$USER/buildarea 
		./bin/gcc-wrap tests/pow_test.c -static

STRUCTURE:
----------

	musllibc/
		Source code original the musl C library

	graflibc/
		Source code original to the grafland C library

	fdlibm/
		Source code original to the Sun libm math library

	tests/
		Various test binaries

	control/
		Identical to tests/

	crt/
		Crt stuff startup assembly code

	include/
		Header files.

	arch/
		Architecture specific header files.

	tools/
		several tools including the gcc-wrap wrapper script


LINKING TO OUTSIDE LIBC:
------------------------

	Many people wish to know the internal magic behind using the gcc-wrap
	wrapper script. Instead of going into much detail I will offer some
	instructions on linking against an outside libc (namely ours) without
	using this wrapper:

		git clone https://www.github.com/cmgraff/grafmusl 
		cd grafmusl 
		./configure 
		make

		gcc -nostdinc -nostdlib -I./include tests/cat.c lib/Scrt1.o lib/libc.a -o cat

			or  ...

		gcc -nostdinc -nostdlib -I./include tests/cat.c lib/crt*.o  lib/libc.a -o cat

		./cat


	Basically we tell the compiler to "-nostdinc (do not include any host 
	headers)", "'-nostdlib' (don't include any host libraries)" "-I./include
	 (use our header files)" and then finally "(link in our crt stuff) 
	lib/Scrt1.o" and "(link in our libc) lib/libc.a"


	The libc itself is of course at lib/libc.a and the dynamically linked 
	version is at lib/libc.so. But the "crt stuff" crt start up files are 
	also needed. These files are written in assembly code and their source 
	code is located at grafmusl/crt/*.



AUTOMATIC TESTING:
------------------

	grafmusl has an extra script added which is named "build.sh" which
	serves as a wrapper to the makefile commands. It compiles  and
	runs a simple test suite. Grafmusl is much easier to test this
	way, as the developer can get a basic idea of any regressions by
	invoking a single command. By default it installs to the directory
	"installation" automatically as a subdirectory of the grafmusl 
	build system. Use the following instructions to retrieve, build
	and run the grafmusl and the grafmusl test suite.


		git clone https://www.githuc.com/cmgraff/grafmusl
		cd grafmusl
		./build.sh

	If all ran successfully there should be no significant errors and
	a confirmation notice containing the results of the test suite 
	will be printed to screen looking something like this:

		==========COMPILING TEST SUITE==============================
		============================================================
		==========TEST SUITE START==================================
		This number should be (16.000000): 16.000000    (4^3)
		This number should be (15.580524): 15.580524    (3.3^2.3)
		The `cat' utility successfully copied a file
		The `malloc_driver' test utility successfully iterated th..
		The `popen_driver' test utility successfully ran `du' on..
		============================================================
		============================================================
		   If all was successful your compiler will be located at:
		              ./usr/bin/gcc-wrap
		============================================================

	If any compiler or linker errors occur within this report then the libc
	has changed and likely regressed or otherwise lost a functionality.


	If you wish to add a new test to the test suite simply put the program
	under tests/ and it will be compiled along with the other tests. 



REVISION CONTROL:
-----------------

	https://github.com/cmgraff/grafmusl


WEB HOME:
---------

	http://www.csit.parkland.edu/~cgraff1/grafmusl


REFERENCES:
-----------

	Musl's home website:

		https://www.musl-libc.org

	A website authored by Rich Felker / dalais, the maker of musl:

		https://ewontfix.com/about 

	A tutorial on implementing malloc:

		https://danluu.com/malloc-tutorial

	Some useful sites from the people on ##c irc.freenode.net

		http://www.iso-9899.info

		http://www.iso-9899.info/wiki/Books

	An early book about the history of unix:

		ftp://minnie.tuhs.org/UnixArchive/Documentation/Books/Life_with_Unix.pdf

	Some small articles pertaining to the book "Software tools" by Kernighan and Plauger

		phk.freebsd.dk/pubs/EuroBSDcon2010_SoftwareTools.pdf

		alumnus.caltech.edu/~copeland/work/PDF/1999-08-ppt.pdf


CONTACT:
--------

	cm0graff@gmail.com


WHY:
----

	Musl has been actively maintained for over 12 years from 2005 to
	the present (2017) making it an ideal study into the workings of a
	modern libc. The primary goal of this project is to reduce an older
	version of musl to its "normative case" of crt stuffs, syscalls and
	linux ABI

	Musl libc also contains a copy of the the Sun fdlibm libm math
	library. It is a goal of this project to also understand and disect
	the sun fdlibm mathematics library.


WHEN WILL IT BE DONE?:
----------------------

	When there is nothing left to remove.



